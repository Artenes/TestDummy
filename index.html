<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>TestDummy by laracasts</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>TestDummy</h1>
          <h2>Laughably simple database seeding for integration testing.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/laracasts/TestDummy/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/laracasts/TestDummy/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/laracasts/TestDummy" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="testdummy-" class="anchor" href="#testdummy-" aria-hidden="true"><span class="octicon octicon-link"></span></a>TestDummy <a href="https://travis-ci.org/laracasts/TestDummy"><img src="https://travis-ci.org/laracasts/TestDummy.svg?branch=master" alt="Build Status"></a>
</h1>

<p><img src="https://dl.dropboxusercontent.com/u/774859/GitHub-Repos/testdummy/crashtestdummy.jpg" alt="image"></p>

<p>TestDummy makes the process of preparing factories (dummy data) for your integration tests as easy as possible.</p>

<p>As easy as...</p>

<h3>
<a id="build-a-post-model-with-dummy-attributes" class="anchor" href="#build-a-post-model-with-dummy-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build a Post model with dummy attributes.</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$post</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>build(<span class="pl-s1"><span class="pl-pds">'</span>Post<span class="pl-pds">'</span></span>);</span></pre></div>

<p>If we then do <code>$post-&gt;toArray()</code>, this might return:</p>

<div class="highlight highlight-bash"><pre>array(4) {
  [<span class="pl-s1"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(21) <span class="pl-s1"><span class="pl-pds">"</span>The Title of the Post<span class="pl-pds">"</span></span>
  [<span class="pl-s1"><span class="pl-pds">"</span>author_id<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(1) <span class="pl-s1"><span class="pl-pds">"</span>5<span class="pl-pds">"</span></span>
  [<span class="pl-s1"><span class="pl-pds">"</span>body<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(226) <span class="pl-s1"><span class="pl-pds">"</span>Iusto qui optio et iste. Cumque aliquid et omnis enim. Nesciunt ad esse a reiciendis expedita quidem veritatis. Nostrum repellendus reiciendis distinctio amet sapiente. Eum molestias a recusandae modi aut et adipisci corrupti.<span class="pl-pds">"</span></span>
  [<span class="pl-s1"><span class="pl-pds">"</span>publish_date<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(19) <span class="pl-s1"><span class="pl-pds">"</span>2014-03-02 11:05:48<span class="pl-pds">"</span></span>
}</pre></div>

<h3>
<a id="build-a-post-but-override-the-default-title" class="anchor" href="#build-a-post-but-override-the-default-title" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build a post, but override the default title.</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$post</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>build(<span class="pl-s1"><span class="pl-pds">'</span>Post<span class="pl-pds">'</span></span>, [<span class="pl-s1"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>Override Title<span class="pl-pds">'</span></span>]);</span></pre></div>

<p>Again, when cast to an array...</p>

<div class="highlight highlight-bash"><pre>array(4) {
  [<span class="pl-s1"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(14) <span class="pl-s1"><span class="pl-pds">"</span>Override Title<span class="pl-pds">"</span></span>
  [<span class="pl-s1"><span class="pl-pds">"</span>author_id<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(1) <span class="pl-s1"><span class="pl-pds">"</span>5<span class="pl-pds">"</span></span>
  [<span class="pl-s1"><span class="pl-pds">"</span>body<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(254) <span class="pl-s1"><span class="pl-pds">"</span>In eos porro qui est rerum possimus voluptatem non. Repudiandae eaque nostrum eaque aut deleniti possimus quod minus. Molestiae commodi odit sunt dignissimos corrupti repudiandae quibusdam quo. Autem maxime tenetur autem corporis aut quis sint occaecati.<span class="pl-pds">"</span></span>
  [<span class="pl-s1"><span class="pl-pds">"</span>publish_date<span class="pl-pds">"</span></span>]=<span class="pl-k">&gt;</span>
  string(19) <span class="pl-s1"><span class="pl-pds">"</span>2013-06-24 10:01:30<span class="pl-pds">"</span></span>
}</pre></div>

<h3>
<a id="build-an-array-of-attributes-for-the-model" class="anchor" href="#build-an-array-of-attributes-for-the-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build an array of attributes for the model.</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$post</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>attributesFor(<span class="pl-s1"><span class="pl-pds">'</span>Post<span class="pl-pds">'</span></span>);</span></pre></div>

<p>The difference between <code>build()</code> and <code>attributesFor()</code> is that the former will return an instance of the given model type (such as <code>Post</code>). The latter will simply return an array of the generated attributes, which can be useful in some situations. </p>

<h3>
<a id="build-and-persist-a-song-entity" class="anchor" href="#build-and-persist-a-song-entity" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build and persist a song entity.</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$song</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>create(<span class="pl-s1"><span class="pl-pds">'</span>Song<span class="pl-pds">'</span></span>);</span></pre></div>

<h3>
<a id="create-and-persist-a-comment-three-times" class="anchor" href="#create-and-persist-a-comment-three-times" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create and persist a comment three times.</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-s3">Factory</span><span class="pl-k">::</span>times(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>create(<span class="pl-s1"><span class="pl-pds">'</span>Comment<span class="pl-pds">'</span></span>);</span></pre></div>

<p>In effect, this will give you three rows in your <code>comments</code> table. If that table has relationships (such as an owning Post), those related rows will be created with dummy data as well.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="step-1-install" class="anchor" href="#step-1-install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1: Install</h3>

<p>Pull this package in through Composer, just like any other package.</p>

<div class="highlight highlight-js"><pre><span class="pl-s1"><span class="pl-pds">"</span>require-dev<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s1"><span class="pl-pds">"</span>laracasts/testdummy<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>~2.0<span class="pl-pds">"</span></span>
}</pre></div>

<h3>
<a id="step-2-create-a-factories-file" class="anchor" href="#step-2-create-a-factories-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2: Create a Factories File</h3>

<p>TestDummy isn't magic. You need to describe the type of data that should be generated.</p>

<p>Within a <code>tests/factories</code> directory, you may create any number of PHP files that will automatically be
loaded by TestDummy. Why don't you start with a generic <code>tests/factories/factories.php</code> file.</p>

<p>Each factory file you create will automatically have access to two variables:</p>

<ul>
<li><code>$factory</code></li>
<li><code>$faker</code></li>
</ul>

<p><code>$factory</code> is the function that you'll use to define new sets of data, such as the makeup of a Post or Album.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>Album<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>Rock or Bust<span class="pl-pds">'</span></span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>AC/DC<span class="pl-pds">'</span></span></span>
<span class="pl-s2">]);</span></pre></div>

<p>Think of this as your definition for any future generated albums - like when you do this:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$album</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>create(<span class="pl-s1"><span class="pl-pds">'</span>Album<span class="pl-pds">'</span></span>);</span></pre></div>

<h4>
<a id="faker" class="anchor" href="#faker" aria-hidden="true"><span class="octicon octicon-link"></span></a>Faker</h4>

<p>You probably won't want to hardcode strings for your various factories. It would be easier and faster to use random data. TestDummy pulls in the excellent <a href="https://github.com/fzaninotto/Faker">Faker</a> library to assist with this.</p>

<p>In fact, any files in your <code>tests/factories/</code> directory will automatically have access to a <code>$faker</code> object that you may use. Here's an example:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>Comment<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">sentence</span></span>
<span class="pl-s2">]);</span></pre></div>

<p>Now, each time you generate a new comment, the <code>body</code> field will be set to a random sentence. Refer to the <a href="https://github.com/fzaninotto/Faker">Faker</a> documentation for a massive list of available fakes.</p>

<h4>
<a id="relationships" class="anchor" href="#relationships" aria-hidden="true"><span class="octicon octicon-link"></span></a>Relationships</h4>

<p>If you wish, TestDummy can automatically generate your relationship models, as well. You just need to let TestDummy know the type of its associated model. TestDummy will then automatically build and save that relationship for you!</p>

<p>Using the <code>Comment</code> example from above, it stands to reason that a comment belongs to a user, right? Let's set that up:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>Comment<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>user_id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>factory:User<span class="pl-pds">'</span></span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">sentence</span></span>
<span class="pl-s2">]);</span></pre></div>

<p>That's it! Notice the special syntax here: "factory:", followed by the name of the associated class/model.</p>

<p>To illustrate this with one more example, if a song belongs to an album, and an album belongs to an artist, then we can easily represent this:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>App\Song<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>album_id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>factory:App\Album<span class="pl-pds">'</span></span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">sentence</span></span>
<span class="pl-s2">]);</span>
<span class="pl-s2"></span>
<span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>App\Album<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>artist_id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>factory:App\Artist<span class="pl-pds">'</span></span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">word</span></span>
<span class="pl-s2">]);</span>
<span class="pl-s2"></span>
<span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>App\Artist<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">word</span></span>
<span class="pl-s2">]);</span></pre></div>

<p>So here's the cool thing: this will all work recursively. In translation, if you do...</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$song</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>create(<span class="pl-s1"><span class="pl-pds">'</span>App\Song<span class="pl-pds">'</span></span>);</span></pre></div>

<p>...then not only will TestDummy build and persist a song to the database, but it'll also do the same for the related album, and its related artist. Nifty!</p>

<h4>
<a id="custom-factories" class="anchor" href="#custom-factories" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Factories</h4>

<p>So far, you've learned how to generate data, using the name of the class, like <code>App\User</code>. However, sometimes, you'll want to define multiple types of users for the purposes of testing.</p>

<p>While it's true that you can use overrides, like this:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-s3">Factory</span><span class="pl-k">::</span>create(<span class="pl-s1"><span class="pl-pds">'</span>App\User<span class="pl-pds">'</span></span>, [<span class="pl-s1"><span class="pl-pds">'</span>role<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>admin<span class="pl-pds">'</span></span>]);</span></pre></div>

<p>...if this is something that you'll be doing often, create a custom factory, like so:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-c">// A generic factory for users...</span></span>
<span class="pl-s2"></span>
<span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>App\User<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">username</span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">password</span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>role<span class="pl-pds">'</span></span>     <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>member<span class="pl-pds">'</span></span></span>
<span class="pl-s2">]);</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">// And a custom one for administrators</span></span>
<span class="pl-s2"></span>
<span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>App\User<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>admin_user<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">username</span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">password</span>,</span>
<span class="pl-s2">    <span class="pl-s1"><span class="pl-pds">'</span>role<span class="pl-pds">'</span></span>     <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>admin<span class="pl-pds">'</span></span></span>
<span class="pl-s2">]);</span></pre></div>

<p>In the code snippet above, you're already familiar with the first example. For the second one, notice that we've added a "short name", or identifier for this special type of user factory. Now, whenever you want to quickly generate an admin user, you may do:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$adminUser</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>create(<span class="pl-s1"><span class="pl-pds">'</span>admin_user<span class="pl-pds">'</span></span>);</span></pre></div>

<h4>
<a id="defining-with-closures" class="anchor" href="#defining-with-closures" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining with Closures</h4>

<p>Alternatively, you may pass a closure as the second argument to the <code>$factory</code> method. This can be useful for situations where you need a bit more control over the values that you assign to each attribute. Here's an example:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">$<span class="pl-vo">factory</span>(<span class="pl-s1"><span class="pl-pds">'</span>App\Artist<span class="pl-pds">'</span></span>, <span class="pl-st">function</span>(<span class="pl-vo">$faker</span>, <span class="pl-vo">$overrides</span>) {</span>
<span class="pl-s2">    <span class="pl-vo">$name</span> <span class="pl-k">=</span> <span class="pl-s3">sprintf</span>(<span class="pl-s1"><span class="pl-pds">'</span>Some Band Named %s<span class="pl-pds">'</span></span>, <span class="pl-vo">$faker</span><span class="pl-k">-&gt;</span><span class="pl-vo">word</span>);</span>
<span class="pl-s2"></span>
<span class="pl-s2">    <span class="pl-k">return</span> [</span>
<span class="pl-s2">        <span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-vo">$name</span></span>
<span class="pl-s2">    ];</span>
<span class="pl-s2">});</span></pre></div>

<p>Of course, just be sure to return an array from this closure. If you don't, an exception will be thrown.</p>

<h3>
<a id="step-3-setup" class="anchor" href="#step-3-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3: Setup</h3>

<p>When testing against a database, it's recommended that each test works with the exact same database environment and structure. That way, you can protect yourself against false positives. An SQLite database (maybe even one in memory) is a good choice in these cases.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">setUp</span>()</span>
<span class="pl-s2">{</span>
<span class="pl-s2">    <span class="pl-st">parent</span><span class="pl-k">::</span>setUp();</span>
<span class="pl-s2"></span>
<span class="pl-s2">    <span class="pl-s3">Artisan</span><span class="pl-k">::</span>call(<span class="pl-s1"><span class="pl-pds">'</span>migrate<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2">}</span></pre></div>

<p>Or, if a DB in memory isn't possible, to save a bit of time, a helper <code>Laracasts\TestDummy\DbTestCase</code> class is included with this package. If you extend it, before each test, your test DB will be migrated (if necessary), and all DB modifications will be channelled through a transaction, and then rolled back on <code>tearDown</code>. This will give you a speed boost, and ensure that all tests start with the same database structure.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\DbTestCase</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">ExampleTest</span> <span class="pl-s">extends</span> <span class="pl-e">DbTestCase</span> {</span>
<span class="pl-s2"></span>
<span class="pl-s2">    <span class="pl-c">/** @test */</span></span>
<span class="pl-s2">    <span class="pl-st">function</span> <span class="pl-en">it_does_something</span>()</span>
<span class="pl-s2">    {</span>
<span class="pl-s2">        <span class="pl-c">// Before each test, your database will be rolled back</span></span>
<span class="pl-s2">    }</span>
<span class="pl-s2">}</span></pre></div>

<h3>
<a id="step-4-write-your-tests" class="anchor" href="#step-4-write-your-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4: Write Your Tests</h3>

<p>You're all set to go now. Start testing! Here's some code to get you started. Assuming that you have a <code>Post</code> and <code>Comment</code> model created...</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">Laracasts\TestDummy\Factory</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$comment</span> <span class="pl-k">=</span> <span class="pl-s3">Factory</span><span class="pl-k">::</span>create(<span class="pl-s1"><span class="pl-pds">'</span>Comment<span class="pl-pds">'</span></span>);</span></pre></div>

<p>This will create and save both a <code>Comment</code>, as well as a <code>Post</code> record to the database.</p>

<p>Or, maybe you need to write a test to ensure that, if you have three songs with their respective lengths, when you call a <code>getTotalLength</code> method on the owning <code>Album</code> model, it will return the correct value. That's easy!</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-c">// create three songs, and explicitly set the length</span></span>
<span class="pl-s2"><span class="pl-s3">Factory</span><span class="pl-k">::</span>times(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>create(<span class="pl-s1"><span class="pl-pds">'</span>Song<span class="pl-pds">'</span></span>, [<span class="pl-s1"><span class="pl-pds">'</span>length<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">200</span>]);</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$album</span> <span class="pl-k">=</span> <span class="pl-s3">Album</span><span class="pl-k">::</span>first(); <span class="pl-c">// this will be created once automatically.</span></span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>assertEquals(<span class="pl-c1">600</span>, <span class="pl-vo">$album</span><span class="pl-k">-&gt;</span>getTotalLength());</span></pre></div>

<p>Now, of course, just make sure that you've registered a definition for a <code>Song</code> and <code>Album</code> in one of your factory files, and you're good to go!</p>

<pre><code>// tests/factories/factories.php

$factory('Song', [
  'album_id' =&gt; 'factory:Album',
  'name' =&gt; $faker-&gt;sentence
]);

$factory('Album', [
  'name' =&gt; $faker-&gt;sentence
]);
</code></pre>

<h3>
<a id="faq" class="anchor" href="#faq" aria-hidden="true"><span class="octicon octicon-link"></span></a>FAQ</h3>

<h4>
<a id="how-do-i-specify-a-different-factories-folder" class="anchor" href="#how-do-i-specify-a-different-factories-folder" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I specify a different factories folder?</h4>

<p>Easy. Before your tests run, add:</p>

<pre><code>Factory::$factoriesPath = 'app/tests/factories';
</code></pre>

<p>Now, TestDummy will look for your registered factories in the <code>app/tests/factories</code> folder.</p>

<h4>
<a id="i-want-to-control-how-my-models-are-built-and-saved" class="anchor" href="#i-want-to-control-how-my-models-are-built-and-saved" aria-hidden="true"><span class="octicon octicon-link"></span></a>I want to control how my models are built and saved...</h4>

<p>Okay, just create your own implementation of <code>Laracasts\TestDummy\IsPersistable</code>. This contract is composed of a few methods that you'll need to implement.</p>

<p>Once you have your implementation, before your tests run, add:</p>

<pre><code>Factory::$databaseProvider = new MyCustomBuilder;
</code></pre>

<p>And that's it! Now, whenever you generate and save an entity, TestDummy will reference your custom implementation.</p>
        </section>

        <footer>
          TestDummy is maintained by <a href="https://github.com/laracasts">laracasts</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>